
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Oracle &#8212; Terra Docs  documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="shortcut icon" href="../../../_static/docs_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Slashing" href="spec-slashing.html" />
    <link rel="prev" title="Mint" href="spec-mint.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/docs_logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../learn/README.html">
   Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../learn/terra-station/README.html">
     Terra Station
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../learn/terra-station/download/README.html">
       Download
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/download/terra-station-desktop.html">
         Terra Station desktop
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/download/terra-station-extension.html">
         Terra Station extension
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/download/terra-station-mobile.html">
         Terra Station mobile
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../learn/terra-station/station-guides/README.html">
       Terra Station guides
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/wallet.html">
         Wallet
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/staking.html">
         Manage delegations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/swap.html">
         Mint, burn, or swap
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/governance.html">
         Governance
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/contracts.html">
         Contracts
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../learn/terra-station/station-guides/testnet.html">
         Use the testnet
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../learn/protocol.html">
     About the Terra Protocol
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../learn/fees.html">
     Fees on Terra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../learn/glossary.html">
     Glossary
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../README.html">
   Develop
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../dapp/README.html">
     Build a dApp
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../dapp/quick-start/README.html">
       5-minute quickstart guide
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/quick-start/initial-setup.html">
         Initial setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/quick-start/using-terrain.html">
         Using Terrain
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../dapp/smart-contracts/README.html">
       In-depth dApp guide
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/smart-contracts/build-terra-dapp.html">
         Build a simple Terra dApp
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/smart-contracts/interact-with-smart-contract.html">
         Interacting with the Contract
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/smart-contracts/manage-cw20-tokens.html">
         CW20 Tokens
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/smart-contracts/set-up-local-environment.html">
         Environment Setup
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../dapp/smart-contracts/write-smart-contract.html">
         Writing the Contract
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../how-to/README.html">
     Guides
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../how-to/terrad/README.html">
       terrad
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/terrad/install-terrad.html">
         Install terrad
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/terrad/using-terrad.html">
         Using terrad
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/terrad/commands.html">
         Commands
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/terrad/subcommands.html">
         Subcommands
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../how-to/localterra/README.html">
       LocalTerra
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/localterra/install-localterra.html">
         Install LocalTerra
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/localterra/configure.html">
         Configure LocalTerra
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/localterra/integrations.html">
         Integrations
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../how-to/localterra/accounts.html">
         Accounts
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../how-to/sign-with-multisig.html">
       Sign with a multisig account
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../how-to/start-lcd.html">
       Start the light client daemon (LCD)
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="README.html">
     Terra core modules
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="spec-auth.html">
       Auth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-authz.html">
       AuthZ
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-bank.html">
       Bank
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-capability.html">
       Capability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-distribution.html">
       Distribution
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-evidence.html">
       Evidence
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-feegrant.html">
       Fee grant
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-governance.html">
       Governance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-market.html">
       Market
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-mint.html">
       Mint
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Oracle
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-slashing.html">
       Slashing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-staking.html">
       Staking
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-treasury.html">
       Treasury
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spec-wasm.html">
       WASM
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sdks/README.html">
     SDKs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../sdks/terra-js/README.html">
       Terra.js
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/add-modules.html">
         Add modules
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/coin-and-coins.html">
         Coin and Coins
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/common-examples.html">
         Common examples
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/fees.html">
         Fees
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/keys.html">
         Keys
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/make-a-connection.html">
         Make a connection
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/msgAuthorization.html">
         MsgAuthorization
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/multisend.html">
         MsgSend
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/numeric.html">
         Numeric
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/oracle-feeder.html">
         Oracle feeder
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/query-data.html">
         Query data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/smart-contracts.html">
         Smart contracts
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/station-extension.html">
         Terra Station extension
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/transactions.html">
         Transactions
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/wallets.html">
         Wallets
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../sdks/terra-js/Websockets.html">
         Websockets
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/README.html">
     Dev reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/endpoints.html">
       RPC endpoints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/history-and-changes.html">
       History and changes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/migration-guide.html">
       Columbus-5 upgrade
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../full-node/README.html">
   Full node
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../full-node/run-a-full-terra-node/README.html">
     Run a full Terra node
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/system-config.html">
       System configuration
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/build-terra-core.html">
       Build Terra core
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/set-up-production.html">
       Set up a production environment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/configure-general-settings.html">
       Configure general settings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/join-a-network.html">
       Join a network
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/sync.html">
       Sync
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/run-a-full-terra-node/updates-and-additional.html">
       Updates and additional settings
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../full-node/manage-a-terra-validator/README.html">
     Manage a validator
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/court-delegations.html">
       Court delegations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/faq.html">
       Validator FAQ
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/implement-security.html">
       Implement security practices
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/set-up-oracle-feeder.html">
       Set up an oracle feeder
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/set-up-validator.html">
       Register your Terra validator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../full-node/manage-a-terra-validator/troubleshoot-validator-problems.html">
       Troubleshoot validator problems
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../full-node/reference/README.html">
     Node reference
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ecosystem/README.html">
   Ecosystem
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ecosystem/explore.html">
     Explore the ecosystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ecosystem/integrations.html">
     Integrations
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/docs/develop/module-specifications/spec-oracle.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/terra-money/docs"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/terra-money/docs/issues/new?title=Issue%20on%20page%20%2Fdocs/develop/module-specifications/spec-oracle.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/terra-money/docs/edit/master/docs/docs/develop/module-specifications/spec-oracle.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concepts">
   Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voting-procedure">
     Voting Procedure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prevote-and-vote">
       Prevote and Vote
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vote-tally">
       Vote Tally
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-cross-exchange-rate-using-reference-terra">
       Compute Cross Exchange Rate using Reference Terra
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ballot-rewards">
       Ballot Rewards
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reward-band">
     Reward Band
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashing">
     Slashing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abstaining-from-voting">
     Abstaining from Voting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#message-types">
   Message Types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgexchangerateprevote">
     MsgExchangeRatePrevote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgexchangeratevote">
     MsgExchangeRateVote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgdelegatefeedconsent">
     MsgDelegateFeedConsent
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgaggregateexchangerateprevote">
     MsgAggregateExchangeRatePrevote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgaggregateexchangeratevote">
     MsgAggregateExchangeRateVote
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#state">
   State
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prevotes">
     Prevotes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votes">
     Votes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#luna-exchange-rate">
     Luna Exchange Rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oracle-delegates">
     Oracle Delegates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validator-misses">
     Validator Misses
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votehash">
     <code class="docutils literal notranslate">
      <span class="pre">
       VoteHash()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tally">
     <code class="docutils literal notranslate">
      <span class="pre">
       tally()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-rewardballotwinners">
     <code class="docutils literal notranslate">
      <span class="pre">
       k.RewardBallotWinners()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashandresetmisscounters">
     <code class="docutils literal notranslate">
      <span class="pre">
       SlashAndResetMissCounters()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transitions">
   Transitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#end-block">
     End-Block
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameters">
   Parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voteperiod">
     VotePeriod
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votethreshold">
     VoteThreshold
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rewardband">
     RewardBand
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rewarddistributionwindow">
     RewardDistributionWindow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#whitelist">
     Whitelist
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashfraction">
     SlashFraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashwindow">
     SlashWindow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#minvalidperwindow">
     MinValidPerWindow
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Oracle</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concepts">
   Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voting-procedure">
     Voting Procedure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#prevote-and-vote">
       Prevote and Vote
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vote-tally">
       Vote Tally
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-cross-exchange-rate-using-reference-terra">
       Compute Cross Exchange Rate using Reference Terra
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ballot-rewards">
       Ballot Rewards
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reward-band">
     Reward Band
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashing">
     Slashing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abstaining-from-voting">
     Abstaining from Voting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#message-types">
   Message Types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgexchangerateprevote">
     MsgExchangeRatePrevote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgexchangeratevote">
     MsgExchangeRateVote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgdelegatefeedconsent">
     MsgDelegateFeedConsent
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgaggregateexchangerateprevote">
     MsgAggregateExchangeRatePrevote
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#msgaggregateexchangeratevote">
     MsgAggregateExchangeRateVote
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#state">
   State
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prevotes">
     Prevotes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votes">
     Votes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#luna-exchange-rate">
     Luna Exchange Rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oracle-delegates">
     Oracle Delegates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validator-misses">
     Validator Misses
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votehash">
     <code class="docutils literal notranslate">
      <span class="pre">
       VoteHash()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tally">
     <code class="docutils literal notranslate">
      <span class="pre">
       tally()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k-rewardballotwinners">
     <code class="docutils literal notranslate">
      <span class="pre">
       k.RewardBallotWinners()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashandresetmisscounters">
     <code class="docutils literal notranslate">
      <span class="pre">
       SlashAndResetMissCounters()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transitions">
   Transitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#end-block">
     End-Block
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameters">
   Parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voteperiod">
     VotePeriod
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#votethreshold">
     VoteThreshold
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rewardband">
     RewardBand
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rewarddistributionwindow">
     RewardDistributionWindow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#whitelist">
     Whitelist
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashfraction">
     SlashFraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#slashwindow">
     SlashWindow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#minvalidperwindow">
     MinValidPerWindow
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="oracle">
<h1>Oracle<a class="headerlink" href="#oracle" title="Permalink to this headline">¶</a></h1>
<p>The Oracle module provides the Terra blockchain with an up-to-date and accurate price feed of exchange rates of Luna against various Terra pegs so that the <a class="reference internal" href="spec-market.html"><span class="doc std std-doc">Market</span></a> may provide fair exchanges between Terra&lt;&gt;Terra currency pairs, as well as Terra&lt;&gt;Luna.</p>
<p>As price information is extrinsic to the blockchain, the Terra network relies on validators to periodically vote on the current Luna exchange rate, with the protocol tallying up the results once per <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> and updating the on-chain exchange rate as the weighted median of the ballot converted Cross Exchange Rates using <code class="docutils literal notranslate"><span class="pre">ReferenceTerra</span></code>.</p>
<div class="highlight-warning notranslate"><div class="highlight"><pre><span></span>Since the Oracle service is powered by validators, you may find it interesting to look at the [Staking](spec-staking.md) module, which covers the logic for staking and validators.
</pre></div>
</div>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="voting-procedure">
<h3>Voting Procedure<a class="headerlink" href="#voting-procedure" title="Permalink to this headline">¶</a></h3>
<p>During each <a class="reference internal" href="#voteperiod"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code></span></a>, the Oracle module obtains consensus on the exchange rate of Luna against denominations specified in <a class="reference internal" href="#whitelist"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">Whitelist</span></code></span></a> by requiring all members of the validator set to submit a vote for Luna exchange rate before the end of the interval.</p>
<p>Validators must first pre-commit to an exchange rate. In the subsequent <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>, validators submit and reveal their exchange rate alongside a proof that they had pre-committed at that price. This scheme forces the voter to commit to a submission before knowing the votes of others. This system reduces centralization and free-rider risk in the Oracle.</p>
<div class="section" id="prevote-and-vote">
<h4>Prevote and Vote<a class="headerlink" href="#prevote-and-vote" title="Permalink to this headline">¶</a></h4>
<p>Let <span class="math notranslate nohighlight">\(P_t\)</span> be the current time interval of duration defined by <a class="reference internal" href="#voteperiod"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code></span></a>(currently set to 5 blockchain blocks) during which validators must submit two messages:</p>
<ul class="simple">
<li><p>A <a class="reference internal" href="#msgexchangerateprevote"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MsgExchangeRatePrevote</span></code></span></a>, containing the SHA256 hash of the exchange rate of Luna with respect to a Terra peg. A separate prevote must be submitted for each different denomination on which to report a Luna exchange rate.</p></li>
<li><p>A <a class="reference internal" href="#msgexchangeratevote"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code></span></a>, containing the salt used to create the hash for the prevote submitted in the previous interval <span class="math notranslate nohighlight">\(P_{t-1}\)</span>.</p></li>
</ul>
</div>
<div class="section" id="vote-tally">
<h4>Vote Tally<a class="headerlink" href="#vote-tally" title="Permalink to this headline">¶</a></h4>
<p>At the end of <span class="math notranslate nohighlight">\(P_t\)</span>, the submitted votes are tallied.</p>
<p>The submitted salt of each vote is used to verify consistency with the prevote submitted by the validator in <span class="math notranslate nohighlight">\(P_{t-1}\)</span>. If the validator has not submitted a prevote, or the SHA256 resulting from the salt does not match the hash from the prevote, the vote is dropped.</p>
<p>For each denomination, if the total voting power of submitted votes exceeds 50%, the weighted median of the votes is recorded on-chain as the effective exchange rate for Luna against that denomination for the following <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> <span class="math notranslate nohighlight">\(P_{t+1}\)</span>.</p>
<p>Denominations receiving fewer than <a class="reference internal" href="#votethreshold"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">VoteThreshold</span></code></span></a> total voting power have their exchange rates deleted from the store, and no swaps can be made with it during the next <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> <span class="math notranslate nohighlight">\(P_{t+1}\)</span>.</p>
<p>Choose <code class="docutils literal notranslate"><span class="pre">ReferenceTerra</span></code> with the highest voter turnout. If the voting power of the two denominations is the same, select reference Terra in alphabetical order.</p>
</div>
<div class="section" id="compute-cross-exchange-rate-using-reference-terra">
<h4>Compute Cross Exchange Rate using Reference Terra<a class="headerlink" href="#compute-cross-exchange-rate-using-reference-terra" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>Choose <code class="docutils literal notranslate"><span class="pre">ReferenceTerra</span></code></p>
<ul class="simple">
<li><p>Let <code class="docutils literal notranslate"><span class="pre">Vote_j</span> <span class="pre">=</span> <span class="pre">Vote_j_1</span> <span class="pre">...</span> <span class="pre">Vote_j_n</span></code> be the <code class="docutils literal notranslate"><span class="pre">uluna</span></code> exchange rate votes for each terra for validator <code class="docutils literal notranslate"><span class="pre">Val_j</span></code> in a given <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>. <code class="docutils literal notranslate"><span class="pre">n</span></code> = number of total terra whitelist</p></li>
<li><p>For all terra whitelist  <code class="docutils literal notranslate"><span class="pre">w_1</span> <span class="pre">...</span> <span class="pre">w_n</span></code>, choose the index <code class="docutils literal notranslate"><span class="pre">r</span></code> with the highest voter turnout. If the vote turnout has multiple tie winner, we choose in alphabetical order. <code class="docutils literal notranslate"><span class="pre">w_r</span></code> is chosen as the <code class="docutils literal notranslate"><span class="pre">ReferenceTerra</span></code> from which to compute cross exchange rates.</p></li>
</ul>
</li>
<li><p>Compute Oracle Exchange Rate</p>
<ul class="simple">
<li><p>Each validator now calculate cross exchange rates(<code class="docutils literal notranslate"><span class="pre">CER</span></code>) for <code class="docutils literal notranslate"><span class="pre">w_i</span></code> as below.</p>
<ul>
<li><p>for <code class="docutils literal notranslate"><span class="pre">i≠r</span></code>, <code class="docutils literal notranslate"><span class="pre">CER_j_i</span> <span class="pre">=</span> <span class="pre">Vote_j_r</span> <span class="pre">/</span> <span class="pre">Vote_j_i</span></code></p></li>
<li><p>for <code class="docutils literal notranslate"><span class="pre">i=r</span></code>, <code class="docutils literal notranslate"><span class="pre">CER_j_i</span> <span class="pre">=</span> <span class="pre">Vote_j_r</span></code></p></li>
</ul>
</li>
<li><p>Calculate power weighted median(<code class="docutils literal notranslate"><span class="pre">PWM</span></code>, across all validators) for each cross exchange rates <code class="docutils literal notranslate"><span class="pre">CER_j_iMCER_i</span></code> = <code class="docutils literal notranslate"><span class="pre">PWM</span></code>(for all j)[<code class="docutils literal notranslate"><span class="pre">CER_j_i</span></code>]</p></li>
<li><p>Now we transform these <code class="docutils literal notranslate"><span class="pre">MCER_i</span></code>s into the original form uluna/terra as below</p>
<ul>
<li><p>for <code class="docutils literal notranslate"><span class="pre">i≠r</span></code>, <code class="docutils literal notranslate"><span class="pre">LunaRate_i</span> <span class="pre">=</span> <span class="pre">MCER_r</span> <span class="pre">/</span> <span class="pre">MCER_i</span></code></p></li>
<li><p>for <code class="docutils literal notranslate"><span class="pre">i=r</span></code>, <code class="docutils literal notranslate"><span class="pre">LunaRate_i</span> <span class="pre">=</span> <span class="pre">MCER_r</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Reward ballot winners</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">i=r</span></code>, same as before, reward ballot winners based <code class="docutils literal notranslate"><span class="pre">CER_j_i</span> <span class="pre">=</span> <span class="pre">Vote_j_r</span></code> ballot with <code class="docutils literal notranslate"><span class="pre">MCER_i</span></code> using <a class="reference internal" href="#tally"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">tally()</span></code></span></a>.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">i≠r</span></code>,  reward ballot winners based <code class="docutils literal notranslate"><span class="pre">CER_j_i</span> <span class="pre">=</span> <span class="pre">Vote_j_r</span> <span class="pre">/</span> <span class="pre">Vote_j_i</span></code> ballot with <code class="docutils literal notranslate"><span class="pre">MCER_i</span></code> using <a class="reference internal" href="#tally"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">tally()</span></code></span></a>.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="ballot-rewards">
<h4>Ballot Rewards<a class="headerlink" href="#ballot-rewards" title="Permalink to this headline">¶</a></h4>
<p>After the votes are tallied, the winners of the ballots are determined with <a class="reference internal" href="#tally"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">tally()</span></code></span></a>.</p>
<p>Voters that have managed to vote within a narrow band around the weighted median are rewarded with swap fees from the oracle reward pool. Swap fees from the reward pool are then distributed over a 2-year period. See <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">k.RewardBallotWinners()</span></code></span> for more details.</p>
</div>
</div>
<div class="section" id="reward-band">
<h3>Reward Band<a class="headerlink" href="#reward-band" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(M\)</span> be the weighted median, <span class="math notranslate nohighlight">\(\sigma\)</span> be the standard deviation of the votes in the ballot, and <span class="math notranslate nohighlight">\(R\)</span> be the <a class="reference internal" href="#rewardband"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">RewardBand</span></code></span></a> parameter. The band around the median is set to be <span class="math notranslate nohighlight">\(\varepsilon = \max(\sigma, R/2)\)</span>. All valid (i.e. bonded and non-jailed) validators that submitted an exchange rate vote in the interval <span class="math notranslate nohighlight">\(\left[ M - \varepsilon, M + \varepsilon \right]\)</span> should be included in the set of winners, weighted by their relative vote power.</p>
</div>
<div class="section" id="slashing">
<h3>Slashing<a class="headerlink" href="#slashing" title="Permalink to this headline">¶</a></h3>
<div class="highlight-danger notranslate"><div class="highlight"><pre><span></span>Be sure to read this section carefully as it concerns potential loss of funds.
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> during which either of the following events occur is considered a “miss”:</p>
<ul class="simple">
<li><p>The validator fails to submits a vote for Luna exchange rate against <strong>each and every</strong> denomination specified in<a class="reference internal" href="#whitelist"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">Whitelist</span></code></span></a>.</p></li>
<li><p>The validator fails to vote within the <a class="reference internal" href="#reward-band"><span class="std std-doc">reward band</span></a> around the weighted median for one or more denominations.</p></li>
</ul>
<p>During every <a class="reference internal" href="#slashwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">SlashWindow</span></code></span></a>, participating validators must maintain a valid vote rate of at least <a class="reference internal" href="#minvalidperwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MinValidPerWindow</span></code></span></a> (5%), lest they get their stake slashed (currently set to <a class="reference internal" href="#slashfraction"><span class="std std-doc">0.01%</span></a>). The slashed validator is automatically temporarily “jailed” by the protocol (to protect the funds of delegators), and the operator is expected to fix the discrepancy promptly to resume validator participation.</p>
</div>
<div class="section" id="abstaining-from-voting">
<h3>Abstaining from Voting<a class="headerlink" href="#abstaining-from-voting" title="Permalink to this headline">¶</a></h3>
<p>A validator may abstain from voting by submitting a non-positive integer for the <code class="docutils literal notranslate"><span class="pre">ExchangeRate</span></code> field in <a class="reference internal" href="#msgexchangeratevote"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code></span></a>. Doing so will absolve them of any penalties for missing <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>s, but also disqualify them from receiving Oracle rewards for faithful reporting.</p>
</div>
</div>
<div class="section" id="message-types">
<h2>Message Types<a class="headerlink" href="#message-types" title="Permalink to this headline">¶</a></h2>
<div class="highlight-warning notranslate"><div class="highlight"><pre><span></span>The control flow for vote-tallying, Luna exchange rate updates, ballot rewards and slashing happens at the end of every `VotePeriod`, and is found at the [end-block ABCI function](#end-block) rather than inside message handlers.
</pre></div>
</div>
<div class="section" id="msgexchangerateprevote">
<h3>MsgExchangeRatePrevote<a class="headerlink" href="#msgexchangerateprevote" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// MsgExchangeRatePrevote - struct for prevoting on the ExchangeRateVote.</span>
<span class="c1">// The purpose of prevote is to hide vote exchange rate with hash</span>
<span class="c1">// which is formatted as hex string in SHA256(&quot;salt:exchange_rate:denom:voter&quot;)</span>
<span class="kd">type</span> <span class="nx">MsgExchangeRatePrevote</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Hash</span>      <span class="kt">string</span>         <span class="s">`json:&quot;hash&quot; yaml:&quot;hash&quot;`</span> <span class="c1">// hex string</span>
	<span class="nx">Denom</span>     <span class="kt">string</span>         <span class="s">`json:&quot;denom&quot; yaml:&quot;denom&quot;`</span>
	<span class="nx">Feeder</span>    <span class="nx">sdk</span><span class="p">.</span><span class="nx">AccAddress</span> <span class="s">`json:&quot;feeder&quot; yaml:&quot;feeder&quot;`</span>
	<span class="nx">Validator</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span> <span class="s">`json:&quot;validator&quot; yaml:&quot;validator&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Hash</span></code> is a hex string generated by the leading 20 bytes of the SHA256 hash (hex string) of a string of the format <code class="docutils literal notranslate"><span class="pre">salt:exchange_rate:denom:voter</span></code>, the metadata of the actual <code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code> to follow in the next <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>. You can use the <a class="reference internal" href="#votehash"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">VoteHash()</span></code></span></a> function to help encode this hash. Note that since in the subsequent <code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code>, the salt will have to be revealed, the salt used must be regenerated for each prevote submission.</p>
<p><code class="docutils literal notranslate"><span class="pre">Denom</span></code> is the denomination of the currency for which the vote is being cast. For example, if the voter wishes to submit a prevote for the usd, then the correct <code class="docutils literal notranslate"><span class="pre">Denom</span></code> is <code class="docutils literal notranslate"><span class="pre">uusd</span></code>.</p>
<p>The exchange rate used in the hash must be the open market exchange rate of Luna, with respect to the denomination matching <code class="docutils literal notranslate"><span class="pre">Denom</span></code>. For example, if <code class="docutils literal notranslate"><span class="pre">Denom</span></code> is <code class="docutils literal notranslate"><span class="pre">uusd</span></code> and the going exchange rate for Luna is 1 USD, then “1” must be used as the exchange rate, as <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">uluna</span></code> = <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">uusd</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Feeder</span></code> (<code class="docutils literal notranslate"><span class="pre">terra-</span></code> address) is used if the validator wishes to delegate oracle vote signing to a separate key (who “feeds” the price in lieu of the operator) to de-risk exposing their validator signing key.</p>
<p><code class="docutils literal notranslate"><span class="pre">Validator</span></code> is the validator address (<code class="docutils literal notranslate"><span class="pre">terravaloper-</span></code>) of the original validator.</p>
</div>
<div class="section" id="msgexchangeratevote">
<h3>MsgExchangeRateVote<a class="headerlink" href="#msgexchangeratevote" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code> contains the actual exchange rate vote. The <code class="docutils literal notranslate"><span class="pre">Salt</span></code> parameter must match the salt used to create the prevote, otherwise the voter cannot be rewarded.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// MsgExchangeRateVote - struct for voting on the exchange rate of Luna denominated in various Terra assets.</span>
<span class="c1">// For example, if the validator believes that the effective exchange rate of Luna in USD is 10.39, that&#39;s</span>
<span class="c1">// what the exchange rate field would be, and if 1213.34 for KRW, same.</span>
<span class="kd">type</span> <span class="nx">MsgExchangeRateVote</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">ExchangeRate</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span>        <span class="s">`json:&quot;exchange_rate&quot; yaml:&quot;exchange_rate&quot;`</span>
	<span class="nx">Salt</span>         <span class="kt">string</span>         <span class="s">`json:&quot;salt&quot; yaml:&quot;salt&quot;`</span>
	<span class="nx">Denom</span>        <span class="kt">string</span>         <span class="s">`json:&quot;denom&quot; yaml:&quot;denom&quot;`</span>
	<span class="nx">Feeder</span>       <span class="nx">sdk</span><span class="p">.</span><span class="nx">AccAddress</span> <span class="s">`json:&quot;feeder&quot; yaml:&quot;feeder&quot;`</span>
	<span class="nx">Validator</span>    <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span> <span class="s">`json:&quot;validator&quot; yaml:&quot;validator&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="msgdelegatefeedconsent">
<h3>MsgDelegateFeedConsent<a class="headerlink" href="#msgdelegatefeedconsent" title="Permalink to this headline">¶</a></h3>
<p>Validators may also elect to delegate voting rights to another key to prevent the block signing key from being kept online. To do so, they must submit a <code class="docutils literal notranslate"><span class="pre">MsgDelegateFeedConsent</span></code>, delegating their oracle voting rights to a <code class="docutils literal notranslate"><span class="pre">Delegate</span></code> that sign <code class="docutils literal notranslate"><span class="pre">MsgExchangeRatePrevote</span></code> and <code class="docutils literal notranslate"><span class="pre">MsgExchangeRateVote</span></code> on behalf of the validator.</p>
<div class="highlight-danger notranslate"><div class="highlight"><pre><span></span>Delegate validators will likely require you to deposit some funds (in Terra or Luna) which they can use to pay fees, sent in a separate `MsgSend`. This agreement is made off-chain and not enforced by the Terra protocol.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Operator</span></code> field contains the operator address of the validator (prefixed <code class="docutils literal notranslate"><span class="pre">terravaloper-</span></code>). The <code class="docutils literal notranslate"><span class="pre">Delegate</span></code> field is the account address (prefixed <code class="docutils literal notranslate"><span class="pre">terra-</span></code>) of the delegate account that will be submitting exchange rate related votes and prevotes on behalf of the <code class="docutils literal notranslate"><span class="pre">Operator</span></code>.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// MsgDelegateFeedConsent - struct for delegating oracle voting rights to another address.</span>
<span class="kd">type</span> <span class="nx">MsgDelegateFeedConsent</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Operator</span>  <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span> <span class="s">`json:&quot;operator&quot; yaml:&quot;operator&quot;`</span>
	<span class="nx">Delegate</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">AccAddress</span> <span class="s">`json:&quot;delegate&quot; yaml:&quot;delegate&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="msgaggregateexchangerateprevote">
<h3>MsgAggregateExchangeRatePrevote<a class="headerlink" href="#msgaggregateexchangerateprevote" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">MsgAggregateExchangeRatePrevote</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Hash</span>      <span class="nx">AggregateVoteHash</span> <span class="s">`json:&quot;hash&quot; yaml:&quot;hash&quot;`</span>
	<span class="nx">Feeder</span>    <span class="nx">sdk</span><span class="p">.</span><span class="nx">AccAddress</span>    <span class="s">`json:&quot;feeder&quot; yaml:&quot;feeder&quot;`</span>
	<span class="nx">Validator</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span>    <span class="s">`json:&quot;validator&quot; yaml:&quot;validator&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="msgaggregateexchangeratevote">
<h3>MsgAggregateExchangeRateVote<a class="headerlink" href="#msgaggregateexchangeratevote" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">MsgAggregateExchangeRateVote</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Salt</span>          <span class="kt">string</span>         <span class="s">`json:&quot;salt&quot; yaml:&quot;salt&quot;`</span>
	<span class="nx">ExchangeRates</span> <span class="kt">string</span>         <span class="s">`json:&quot;exchange_rates&quot; yaml:&quot;exchange_rates&quot;`</span> <span class="c1">// comma separated dec coins</span>
	<span class="nx">Feeder</span>        <span class="nx">sdk</span><span class="p">.</span><span class="nx">AccAddress</span> <span class="s">`json:&quot;feeder&quot; yaml:&quot;feeder&quot;`</span>
	<span class="nx">Validator</span>     <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span> <span class="s">`json:&quot;validator&quot; yaml:&quot;validator&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="state">
<h2>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prevotes">
<h3>Prevotes<a class="headerlink" href="#prevotes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">map[voter:</span> <span class="pre">ValAddress][denom:</span> <span class="pre">string]ExchangeRatePrevote</span></code></p></li>
</ul>
<p>Contains validator <code class="docutils literal notranslate"><span class="pre">voter</span></code>’s prevote for a given <code class="docutils literal notranslate"><span class="pre">denom</span></code> for the current <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>.</p>
</div>
<div class="section" id="votes">
<h3>Votes<a class="headerlink" href="#votes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">map[voter:</span> <span class="pre">ValAddress][denom:</span> <span class="pre">string]ExchangeRateVote</span></code></p></li>
</ul>
<p>Contains validator <code class="docutils literal notranslate"><span class="pre">voter</span></code>’s vote for a given <code class="docutils literal notranslate"><span class="pre">denom</span></code> for the current <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>.</p>
</div>
<div class="section" id="luna-exchange-rate">
<h3>Luna Exchange Rate<a class="headerlink" href="#luna-exchange-rate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">map[denom:</span> <span class="pre">string]Dec</span></code></p></li>
</ul>
<p>Stores the current Luna exchange rate against a given <code class="docutils literal notranslate"><span class="pre">denom</span></code>, which is used by the <a class="reference internal" href="spec-market.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">Market</span></code></span></a> module for pricing swaps.</p>
</div>
<div class="section" id="oracle-delegates">
<h3>Oracle Delegates<a class="headerlink" href="#oracle-delegates" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">map[operator:</span> <span class="pre">ValAddress]AccAddress</span></code></p></li>
</ul>
<p>Address of <code class="docutils literal notranslate"><span class="pre">operator</span></code>’s delegated price feeder.</p>
</div>
<div class="section" id="validator-misses">
<h3>Validator Misses<a class="headerlink" href="#validator-misses" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">map[operator:</span> <span class="pre">ValAddress]int64</span></code></p></li>
</ul>
<p>An <code class="docutils literal notranslate"><span class="pre">int64</span></code> representing the number of <code class="docutils literal notranslate"><span class="pre">VotePeriods</span></code> that validator <code class="docutils literal notranslate"><span class="pre">operator</span></code> missed during the current <code class="docutils literal notranslate"><span class="pre">SlashWindow</span></code>.</p>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="votehash">
<h3><code class="docutils literal notranslate"><span class="pre">VoteHash()</span></code><a class="headerlink" href="#votehash" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">VoteHash</span><span class="p">(</span><span class="nx">salt</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">rate</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span><span class="p">,</span> <span class="nx">denom</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">voter</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ValAddress</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>This function computes the truncated SHA256 hash value from <code class="docutils literal notranslate"><span class="pre">salt:rate:denom:voter</span></code> for an <code class="docutils literal notranslate"><span class="pre">ExchangeRateVote</span></code>, which is submitted in an <code class="docutils literal notranslate"><span class="pre">MsgExchangeRatePrevote</span></code> in the <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> prior.</p>
</div>
<div class="section" id="tally">
<h3><code class="docutils literal notranslate"><span class="pre">tally()</span></code><a class="headerlink" href="#tally" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">tally</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">pb</span> <span class="nx">types</span><span class="p">.</span><span class="nx">ExchangeRateBallot</span><span class="p">,</span> <span class="nx">rewardBand</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span><span class="p">)</span> <span class="p">(</span><span class="nx">weightedMedian</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span><span class="p">,</span> <span class="nx">ballotWinners</span> <span class="p">[]</span><span class="nx">types</span><span class="p">.</span><span class="nx">Claim</span><span class="p">)</span>
</pre></div>
</div>
<p>This function contains the logic for tallying up the votes for a specific ballot of a denomination, and determines the weighted median <span class="math notranslate nohighlight">\(M\)</span> as well as the winners of the ballot.</p>
</div>
<div class="section" id="k-rewardballotwinners">
<h3><code class="docutils literal notranslate"><span class="pre">k.RewardBallotWinners()</span></code><a class="headerlink" href="#k-rewardballotwinners" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">k</span> <span class="nx">Keeper</span><span class="p">)</span> <span class="nx">RewardBallotWinners</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">ballotWinners</span> <span class="nx">types</span><span class="p">.</span><span class="nx">ClaimPool</span><span class="p">)</span>
</pre></div>
</div>
<p>At the end of every <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>, a portion of swap fees are rewarded to the oracle ballot winners (validators who submitted an exchange rate vote within the band).</p>
<p>The total amount of Luna rewarded per <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code> is equal to the current amount of Luna in the reward pool (the Luna owned by the Oracle module) divided by the parameter <a class="reference internal" href="#rewarddistributionwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">RewardDistributionWindow</span></code></span></a>.</p>
<p>Each winning validator gets a portion of the reward proportional to their winning vote weight for that period.</p>
</div>
<div class="section" id="slashandresetmisscounters">
<h3><code class="docutils literal notranslate"><span class="pre">SlashAndResetMissCounters()</span></code><a class="headerlink" href="#slashandresetmisscounters" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">SlashAndResetMissCounters</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">k</span> <span class="nx">Keeper</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called at the end of every <code class="docutils literal notranslate"><span class="pre">SlashWindow</span></code> and will check the miss counters of every validator to see if that validator met the minimum valid votes defined in the parameter <a class="reference internal" href="#minvalidperwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MinValidPerWindow</span></code></span></a> (did not miss more than the threshold).</p>
<p>If a validator does not reach the criteria, their staked funds are slashed by <a class="reference internal" href="#slashfraction"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">SlashFraction</span></code></span></a>, and they are jailed.</p>
<p>After checking all validators, all miss counters are reset back to zero for the next <code class="docutils literal notranslate"><span class="pre">SlashWindow</span></code>.</p>
</div>
</div>
<div class="section" id="transitions">
<h2>Transitions<a class="headerlink" href="#transitions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="end-block">
<h3>End-Block<a class="headerlink" href="#end-block" title="Permalink to this headline">¶</a></h3>
<p>At the end of every block, the Oracle module checks whether it’s the last block of the <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>. If it is, it runs the <a class="reference internal" href="#voting-procedure"><span class="std std-doc">Voting Procedure</span></a>:</p>
<ol class="arabic simple">
<li><p>All current active Luna exchange rates are purged from the store</p></li>
<li><p>Received votes are organized into ballots by denomination. Abstained votes, as well as votes by inactive or jailed validators are ignored</p></li>
<li><p>Denominations not meeting the following requirements will be dropped:</p>
<ul class="simple">
<li><p>Must appear in the permitted denominations in <a class="reference internal" href="#whitelist"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">Whitelist</span></code></span></a></p></li>
<li><p>Ballot for denomination must have at least <a class="reference internal" href="#votethreshold"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">VoteThreshold</span></code></span></a> total vote power</p></li>
<li><p>Choose <code class="docutils literal notranslate"><span class="pre">ReferenceTerra</span></code> with the highest voter turnout</p></li>
</ul>
</li>
<li><p>For each remaining <code class="docutils literal notranslate"><span class="pre">denom</span></code> with a passing ballot:</p>
<ul class="simple">
<li><p>Tally up votes with <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">Compute</span> <span class="pre">Cross</span> <span class="pre">Exchange</span> <span class="pre">Rate</span> <span class="pre">using</span> <span class="pre">Reference</span> <span class="pre">Terra</span></code></span> and find the weighted median exchange rate and winners with <a class="reference internal" href="#tally"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">tally()</span></code></span></a></p></li>
<li><p>Iterate through winners of the ballot and add their weight to their running total</p></li>
<li><p>Set the Luna exchange rate on the blockchain for that Luna&lt;&gt;<code class="docutils literal notranslate"><span class="pre">denom</span></code> with <code class="docutils literal notranslate"><span class="pre">k.SetLunaExchangeRate()</span></code></p></li>
<li><p>Emit a <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">exchange_rate_update</span></code></span> event</p></li>
</ul>
</li>
<li><p>Count up the validators who <a class="reference internal" href="#slashing"><span class="std std-doc">missed</span></a> the Oracle vote and increase the appropriate miss counters</p></li>
<li><p>If at the end of a <a class="reference internal" href="#slashwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">SlashWindow</span></code></span></a>, penalize validators who have missed more than the penalty threshold (submitted fewer valid votes than <a class="reference internal" href="#minvalidperwindow"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">MinValidPerWindow</span></code></span></a>)</p></li>
<li><p>Distribute rewards to ballot winners with <a class="reference internal" href="#k-rewardballotwinners"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">k.RewardBallotWinners()</span></code></span></a></p></li>
<li><p>Clear all prevotes (except ones for the next <code class="docutils literal notranslate"><span class="pre">VotePeriod</span></code>) and votes from the store</p></li>
</ol>
<div class="highlight-details notranslate"><div class="highlight"><pre><span></span>
| Type                 | Attribute Key | Attribute Value |
| -------------------- | ------------- | --------------- |
| exchange_rate_update | denom         | {denom}         |
| exchange_rate_update | exchange_rate | {exchangeRate}  |

</pre></div>
</div>
</div>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>The subspace for the Oracle module is <code class="docutils literal notranslate"><span class="pre">oracle</span></code>.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Params oracle parameters</span>
<span class="kd">type</span> <span class="nx">Params</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">VotePeriod</span>               <span class="kt">int64</span>     <span class="s">`json:&quot;vote_period&quot; yaml:&quot;vote_period&quot;`</span>
	<span class="nx">VoteThreshold</span>            <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span>   <span class="s">`json:&quot;vote_threshold&quot; yaml:&quot;vote_threshold&quot;`</span>
	<span class="nx">RewardBand</span>               <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span>   <span class="s">`json:&quot;reward_band&quot; yaml:&quot;reward_band&quot;`</span>
	<span class="nx">RewardDistributionWindow</span> <span class="kt">int64</span>     <span class="s">`json:&quot;reward_distribution_window&quot; yaml:&quot;reward_distribution_window&quot;`</span>
	<span class="nx">Whitelist</span>                <span class="nx">DenomList</span> <span class="s">`json:&quot;whitelist&quot; yaml:&quot;whitelist&quot;`</span>
	<span class="nx">SlashFraction</span>            <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span>   <span class="s">`json:&quot;slash_fraction&quot; yaml:&quot;slash_fraction&quot;`</span>
	<span class="nx">SlashWindow</span>              <span class="kt">int64</span>     <span class="s">`json:&quot;slash_window&quot; yaml:&quot;slash_window&quot;`</span>
	<span class="nx">MinValidPerWindow</span>        <span class="nx">sdk</span><span class="p">.</span><span class="nx">Dec</span>   <span class="s">`json:&quot;min_valid_per_window&quot; yaml:&quot;min_valid_per_window&quot;`</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="voteperiod">
<h3>VotePeriod<a class="headerlink" href="#voteperiod" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
<li><p>default value: `5 blockchain blocks’</p></li>
</ul>
<p>The number of blocks during which voting takes place.</p>
</div>
<div class="section" id="votethreshold">
<h3>VoteThreshold<a class="headerlink" href="#votethreshold" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">Dec</span></code></p></li>
<li><p>default value: 50%</p></li>
</ul>
<p>The minimum percentage of votes that must be received for a ballot to pass.</p>
</div>
<div class="section" id="rewardband">
<h3>RewardBand<a class="headerlink" href="#rewardband" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">Dec</span></code></p></li>
<li><p>default value: 7%</p></li>
</ul>
<p>The tolerated error from the final weighted mean exchange rate that can receive rewards.</p>
</div>
<div class="section" id="rewarddistributionwindow">
<h3>RewardDistributionWindow<a class="headerlink" href="#rewarddistributionwindow" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
<li><p>default value: <code class="docutils literal notranslate"><span class="pre">BlocksPerYear</span></code> (2 year window)</p></li>
</ul>
<p>The number of blocks during which oracle rewards from swap fees comes in and then are distributed.</p>
</div>
<div class="section" id="whitelist">
<h3>Whitelist<a class="headerlink" href="#whitelist" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">oracle.DenomList</span></code></p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">[ukrt,</span> <span class="pre">uusd,</span> <span class="pre">usdr]</span></code></p></li>
</ul>
<p>The list of currencies that can be voted on. This is set to (µKRW, µSDR, µUSD) by default.</p>
</div>
<div class="section" id="slashfraction">
<h3>SlashFraction<a class="headerlink" href="#slashfraction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">Dec</span></code></p></li>
<li><p>default: 0.01%</p></li>
</ul>
<p>The ratio of penalty on bonded tokens.</p>
</div>
<div class="section" id="slashwindow">
<h3>SlashWindow<a class="headerlink" href="#slashwindow" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">BlocksPerWeek</span></code></p></li>
</ul>
<p>The number of blocks for slashing tallying.</p>
</div>
<div class="section" id="minvalidperwindow">
<h3>MinValidPerWindow<a class="headerlink" href="#minvalidperwindow" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>type: <code class="docutils literal notranslate"><span class="pre">Dec</span></code></p></li>
<li><p>default: 5%</p></li>
</ul>
<p>The ratio of minimum valid oracle votes per slash window to avoid slashing.</p>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="spec-mint.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Mint</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="spec-slashing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Slashing</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Terraform Labs<br/>
    
        &copy; Copyright 2021, Terraform Labs.<br/>
      <div class="extra_footer">
        <div class="logos"><a href="https://discord.gg/e29HWwC2Mz" rel="noopener" target="_blank"><img src="https://docs.terra.money/img/discord.svg" alt="link to Terra discord room"></a> <a href="https://medium.com/terra-money" rel="noopener" target="_blank"><img src="https://docs.terra.money/img/medium.svg" alt="link to Terra medium"></a> <a href="https://twitter.com/terra_money" rel="noopener" target="_blank"><img src="https://docs.terra.money/img/twitter.svg" alt="link to Terra twitter"></a> <a href="https://www.youtube.com/channel/UCoV1RXZ9ZBGcuu_PMTTlM0g" rel="noopener" target="_blank"><img src="https://docs.terra.money/img/icon_youtube.png" alt="link to Terra youtube"></a> <a href="https://t.me/terra_announcements" rel="noopener" target="_blank"><img src="https://docs.terra.money/img/icon_telegram.png" alt="link to Terra telegram room"></a></div>
      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>